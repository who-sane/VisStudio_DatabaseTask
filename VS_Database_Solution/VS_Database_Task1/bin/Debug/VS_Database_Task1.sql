/*
Deployment script for VS_Database_Task1

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DeployTestData "true"
:setvar DatabaseName "VS_Database_Task1"
:setvar DefaultFilePrefix "VS_Database_Task1"
:setvar DefaultDataPath "C:\Users\Hussein Hussein\AppData\Local\Microsoft\VisualStudio\SSDT\VS_Database_Solution"
:setvar DefaultLogPath "C:\Users\Hussein Hussein\AppData\Local\Microsoft\VisualStudio\SSDT\VS_Database_Solution"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Creating Procedure [dbo].[ADD_CUSTOMER]...';


GO
CREATE PROCEDURE ADD_CUSTOMER @PSTAFFID INT, @PDATEASSIGNED NVARCHAR(100), @pFNAME NVARCHAR(50), @pLNAME NVARCHAR(50)  AS

BEGIN
    BEGIN TRY

        IF @PSTAFFID < 1 OR @PSTAFFID > 499
            THROW 50020, 'Customer ID out of range', 1

        INSERT INTO Employee (StaffID, DateAssigned, GivenName, Surname) 
        VALUES (@PSTAFFID, @pFNAME, @pLNAME, null);

    RETURN 0 

    END TRY
    BEGIN CATCH
        if ERROR_NUMBER() = 2627
            THROW 50010, 'Duplicate customer ID', 1
        ELSE IF ERROR_NUMBER() = 50020
            THROW
        ELSE
            BEGIN
                DECLARE @ERRORMESSAGE NVARCHAR(MAX) = ERROR_MESSAGE();
                THROW 50000, @ERRORMESSAGE, 1
            END; 
    END CATCH;

END;
GO
if ('$(DeployTestData)' = 'true')

insert into assignment values ('04/05/2002')
insert into assignment values ('07/09/2021')
insert into assignment values ('01/02/2012')


insert into Office values 
(001, '04/05/2002', '16 Boardfish Road', 'sample desc'),
(002, '07/09/2021', '17 Hollywood Ave', 'sample desc'),
(003, '01/02/2012', '1 Lacuve` Blve', 'sample desc')


insert into Employee values 
(0001, '04/05/2002', 'Humphrey','Stand'),
(0002, '07/09/2021', 'Finn','Barr' ),
(0003, '01/02/2012', 'Steve','Jobless')

SELECT * FROM Office
GO

GO
PRINT N'Update complete.';


GO
